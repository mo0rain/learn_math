
# 1

```python
from random import *
from secret import flag
from Crypto.Util.number import *

m = bytes_to_long(flag)
p = getPrime(1024)
q = getPrime(1024)
N = p * q

while True:
    gift = getrandbits(962)
    d0 = getrandbits(71)
    d1 = getrandbits(61)
    d = gift * d1 + d0

    if GCD(d, (p - 1) * (q - 1)) == 1:
        e = inverse(d, (p - 1) * (q - 1))
        break

c = pow(m, e, N)
print('N =', N)
print('e =', e)
print('c =', c)
print('gift =', gift)

# N = 18585217398105629125520924759282759601472213163515462958832167286648912562436568270748530670724611278444024967937907832925342928156387839726595139533045274068236864780358792455412545584018987095121564395436886051909454460422514503940942654809020720231521659944707498480941469933909406861494928698556981676589300055081512579612329460039392649583759219155945240430726252496308026256255235468146280742482534972808688254715010948609148667318667377939343935969198805397965496125133928135880606276399991945619292312197513135531160496695114548554015128298496027769403845355176404375426135201041998117821799087651660368421193
# e = 13672009168107200477462156112208442514985168632893719886476142032744815931914768435895052077709170766586838966459468461811169692523930861310621474737373374564590300129562077896081844753129282849436402385025140541892334906527927426068403247791955374081789801996347118540832792602708613707327329928433319118324681067932207086287932722004943433903570793263349808828070333867744625858067710502648628532516085798471052379056653552830618241007030115861452834490476628742330741879358367503028527345086392422312128693309360364053128218809235555663442820943643365892865522904816033914056964636401723539354079485710131503097847
# c = 16785316696969480068073808870892815764254210608554050318787929780573138718198175806778303405512120731096742074918396877088185801481992889862653559500841101775607125885787021903949351792567767228701087005709500960974182406152656179066979091552447505123517758748610921945935701365397903728464206428248229340317960062409910792956720301000614739646139836581793534376054976721997715068292596614818971959654786534989994764560916070552148352447468228657483665114554990371302659031209521236741474801603779357220611218095423745118002223100359872009462533379707888374891813159186625155073935922980472152732688220601009818024237
# gift = 28000886658277177794905821459720955162311292326109967577375774757672174307206826384389289633451490855820288453983352957979846063680138659913128491916513764374427147250059402991140985597705491424240488482558392624768260761030508027088757321332263071517304397314949001009907789380642603435952



```


# NPUCTF2020 EzRSA üÜó

```python
from gmpy2 import lcm , powmod , invert , gcd , mpz
from Crypto.Util.number import getPrime
from sympy import nextprime
from random import randint
p = getPrime(1024)
q = getPrime(1024)
n = p * q
gift = lcm(p - 1 , q - 1)
e = 54722
flag = b'NPUCTF{******************}'
m = int.from_bytes(flag , 'big')
c = powmod(m , e , n)
print('n: ' , n)
print('gift: ' , gift)
print('c: ' , c)

#n:  17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121
#gift:  2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104
#c:  3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319
```


```
lcmÂáΩÊï∞ÔºåÊ±ÇÊúÄÂ∞èÂÖ¨ÂÄçÊï∞

giftÂàÜËß£‰∏∫
gift = 8 * 11 * 97 * 9601 * 26057167557433418766727399341516665922795024485718296827775927226598694152064298989740080209950805089159979564300359652085874056289167084685303669920341402021998569251561854184586912056788515477034039863935829715784489123437315798902409373317578932823488000322365526936227790036245092665207472438169954702748857842187299166976320465787901470261800372425345547560303561842376571751928531743505412746346436473024093575122041981043859827477404447458211341273671273506575488189374812217939984540494633634622813448773520886788206836310702581026986331011987344147901504555559723572981774237352245997308787165273589

ÊúÄÂ∞èÂÖ¨ÂÄçÊï∞(p,q)¬†‚àó¬†ÊúÄÂ§ßÂÖ¨Âõ†Êï∞(p,q)¬†=¬†p‚àóq

gift = lcm(p - 1 , q - 1)

gift * gcd(p-1,q-1) = (p-1)*(q-1) = phi

print(len(bin(gift)[2:]))
2045

phi‰ΩçÊï∞ÊòØ2048

gcd(p‚àí1,q‚àí1)gcd(p‚àí1,q‚àí1)Âç†3bits
Âõ†Ê≠§ÊúÄÂ§ßÂÖ¨Âõ†Êï∞ÁöÑËåÉÂõ¥ÔºàÂçÅËøõÂà∂Ôºâ‰∏∫[4,8]


Âú®Ê≠§ËåÉÂõ¥ÂÜÖÈÅçÂéÜÊúÄÂ§ßÂÖ¨Âõ†Êï∞ÁöÑÂÄºÔºåÁÑ∂Âêé‰∏éÊúÄÂ∞èÂÖ¨ÂÄçÊï∞Áõ∏‰πòÂæóÂà∞phiÁöÑÂÄº

eÂÄº‰∏çÊòØÁ¥†Êï∞ÔºåÂàÜËß£ÂèØ‰ª•ÂæóÂà∞
e = 2‚àó27361


ÊâÄ‰ª•ÔºåÂú®ËÆ°ÁÆóÊó∂ÔºåÈúÄË¶ÅÂ∞ÜÂéüÂÖàÁöÑeÂÄºÈô§‰ª•2ÊâçÂèØ‰ª•ËøõË°åÂ∏∏ËßÑÁöÑËß£ÂØÜÊìç‰Ωú„ÄÇ

c = (m^2)^(e/2) mod n
ÊâÄ‰ª•Ëß£Âá∫ÁöÑÊòéÊñáÈúÄË¶ÅÂºÄÊ†πÂè∑ÂÜçËΩ¨‰∏∫Â≠óËäÇÊµÅ






```

```python

from Crypto.Util.number import *
import gmpy2
e = 54722
n = 17083941230213489700426636484487738282426471494607098847295335339638177583685457921198569105417734668692072727759139358207667248703952436680183153327606147421932365889983347282046439156176685765143620637107347870401946946501620531665573668068349080410807996582297505889946205052879002028936125315312256470583622913646319779125559691270916064588684997382451412747432722966919513413709987353038375477178385125453567111965259721484997156799355617642131569095810304077131053588483057244340742751804935494087687363416921314041547093118565767609667033859583125275322077617576783247853718516166743858265291135353895239981121
gift = 2135492653776686212553329560560967285303308936825887355911916917454772197960682240149821138177216833586509090969892419775958406087994054585022894165950768427741545736247918410255804894522085720642952579638418483800243368312702566458196708508543635051350999572787188236243275631609875253617015664414032058822919469443284453403064076232765024248435543326597418851751586308514540124571309152787559712950209357825576896132278045112177910266019741013995106579484868768251084453338417115483515132869594712162052362083414163954681306259137057581036657441897428432575924018950961141822554251369262248368899977337886190114104
c = 3738960639194737957667684143565005503596276451617922474669745529299929395507971435311181578387223323429323286927370576955078618335757508161263585164126047545413028829873269342924092339298957635079736446851837414357757312525158356579607212496060244403765822636515347192211817658170822313646743520831977673861869637519843133863288550058359429455052676323196728280408508614527953057214779165450356577820378810467527006377296194102671360302059901897977339728292345132827184227155061326328585640019916328847372295754472832318258636054663091475801235050657401857262960415898483713074139212596685365780269667500271108538319

for gcd_val in range(4, 8):
	phi = gift * gcd_val
	try:
		d = gmpy2.invert(e//2,phi)
		m_2 = pow(c,d,n)
		flag = long_to_bytes(gmpy2.isqrt(m_2))
		print(flag)
	except:
		pass

```



# [ÁæäÂüéÊùØ 2021]Easy_Rsa ‚≠ê

```python
from Crypto.Util.number import *
from flag import flag
import gmpy2

def gen_prime(nbits, gamma):
    g = getPrime(int(nbits * gamma))
    # 491‰Ωç
    alpha = 0.5 - gamma 
    # alpha = 0.02
    while True:
        a = getRandomNBitInteger(int(alpha * nbits))
        # a‰∏∫20‰Ωç
        p = 2 * g * a + 1
        if isPrime(p):
            b = getRandomNBitInteger(int(alpha * nbits))
            # b‰πüÊòØ20‰Ωç
            q = 2 * g * b + 1
            h = 2 * g * a * b + a + b
            while not isPrime(q) or isPrime(h) or gmpy2.gcd(a, b) != 1:
                b = getRandomNBitInteger(int(alpha * nbits))
                q = 2 * g * b + 1
            return p, q

def encrypt(nbits, gamma):
    p, q = gen_prime(nbits, gamma)
    n = p * q
    e = getPrime(16)
    while gmpy2.gcd(e, gmpy2.lcm(p-1,q-1)) != 1:
        e = getPrime(16)
    m = bytes_to_long(flag)
    c = pow(m, e, n)
    return n, e, c

n, e, c = encrypt(1024, 0.48)
print 'n =', n
print 'e =', e
print 'c =', c

# n = 84236796025318186855187782611491334781897277899439717384242559751095347166978304126358295609924321812851255222430530001043539925782811895605398187299748256080526691975084042025794113521587064616352833904856626744098904922117855866813505228134381046907659080078950018430266048447119221001098505107823645953039
# e = 58337
# c = 13646200911032594651110040891135783560995665642049282201695300382255436792102048169200570930229947213493204600006876822744757042959653203573780257603577712302687497959686258542388622714078571068849217323703865310256200818493894194213812410547780002879351619924848073893321472704218227047519748394961963394668

h = 2gab + a + b
n = pq = (2ga+1)*(2gb+1) = 4g^2ab + 2ga + 2gb + 1 = 2(2gab+a+b)g + 1 = 2gh + 1
n - 1 = 2gh
ÂÅáËÆæhÊòìÂàÜËß£ÔºåÈÄöËøáÂàÜËß£n-1

ÂæóÂà∞gÂíåh
p = 2ga + 1
p | N ËøõË°åÁàÜÁ†¥a
‰ΩÜÊòØn-1‰∏çÂ•ΩÂàÜËß£

phi = (p-1)(q-1) = 4g^2ab = (n-1)^2
```

$$\Huge
\begin{align*}

c^{(N-1)^2}=c^{4g^2h^2} \\


Ê¨ßÊãâÂÆöÁêÜ \\
c^{phi} \equiv 1\ (mod\ n)\\
(c^{(n-1)^2})^k \equiv 1 (mod\ n) \\

491^2*4 = 964324 \\
2^{20} = 1048576 \\
2^{19} = 524288 \\



\end{align*}
$$

```python
from sage.groups.generic import bsgs
from Crypto.Util.number import *

N = 84236796025318186855187782611491334781897277899439717384242559751095347166978304126358295609924321812851255222430530001043539925782811895605398187299748256080526691975084042025794113521587064616352833904856626744098904922117855866813505228134381046907659080078950018430266048447119221001098505107823645953039
e = 58337
c = 13646200911032594651110040891135783560995665642049282201695300382255436792102048169200570930229947213493204600006876822744757042959653203573780257603577712302687497959686258542388622714078571068849217323703865310256200818493894194213812410547780002879351619924848073893321472704218227047519748394961963394668

Zn = Zmod(N)

g = Zn(c)
one = Zn(1)

gg = g ^ ((N-1)^2)
k = bsgs(gg, one, bounds=(1, 2^40), operation='*')

phi = k * ((N-1)^2)

d = inverse(e, phi)
m = pow(c, d, N)
print(m)
print(long_to_bytes(m))


```

https://zhuanlan.zhihu.com/p/435012704
https://www.ctfer.vip/note/set/107



# [NCTF 2019]easyRSA

